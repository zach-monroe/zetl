# Helm values for kube-prometheus-stack on K3s
# Copy to values.yaml and customize before deploying:
#   cp values.example.yaml values.yaml
#
# Install:
#   helm install kube-prometheus-stack prometheus-community/kube-prometheus-stack \
#     --namespace monitoring --values values.yaml

prometheus:
  prometheusSpec:
    retention: 15d
    resources:
      requests:
        memory: 512Mi
      limits:
        memory: 1Gi
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: local-path
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 20Gi
    # Discover ServiceMonitors in all namespaces (needed for postgres-exporter)
    serviceMonitorSelectorNilUsesHelmValues: false

grafana:
  adminPassword: CHANGE_ME_GRAFANA_ADMIN_PASSWORD
  persistence:
    enabled: true
    storageClassName: local-path
    size: 2Gi
  ingress:
    enabled: true
    ingressClassName: traefik
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - grafana.example.com
    tls:
      - secretName: grafana-tls
        hosts:
          - grafana.example.com

alertmanager:
  alertmanagerSpec:
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: local-path
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 1Gi

nodeExporter:
  enabled: true

kubeStateMetrics:
  enabled: true

# K3s bundles these components into the k3s binary;
# standard scrape targets don't exist, so disable them.
kubeControllerManager:
  enabled: false
kubeScheduler:
  enabled: false
kubeEtcd:
  enabled: false
kubeProxy:
  enabled: false
